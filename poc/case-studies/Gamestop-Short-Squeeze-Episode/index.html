<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSCP Case Study: GameStop "Short Squeeze" episode</title>
    <style>
        :root {
            --primary: #2c3e50;
            --accent: #3498db;
            --bg: #f4f6f7;
            --panel-bg: #ffffff;
            --border: #ddd;
            --code-bg: #1e1e1e;
            --text-light: #ecf0f1;
        }
        
        /* Global Layout */
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: var(--bg); margin: 0; padding: 5px; color: #333; display: flex; justify-content: center; min-height: 100vh; }
        
        .main-wrapper { width: 100%; max-width: 1000px; display: flex; flex-direction: column; }

        /* Header Ultra-Compact */
        header { 
            text-align: center; 
            margin-bottom: 8px; 
            background: white; 
            padding: 8px; 
            border-radius: 8px; 
            box-shadow: 0 2px 5px rgba(0,0,0,0.05); 
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 { margin: 0; color: var(--primary); font-size: 1.2rem; display: flex; align-items: center; gap: 6px; }
        
        /* Title Link Style */
        .title-link {
            text-decoration: none;
            color: var(--primary);
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
        }
        .title-link:hover {
            color: var(--accent);
            border-bottom-color: var(--accent);
        }

        .header-meta { display: flex; align-items: center; gap: 10px; }
        .subtitle { color: #7f8c8d; font-style: italic; font-size: 0.8rem; }
        .context-link { font-size: 0.75em; color: var(--accent); text-decoration: none; border: 1px solid var(--accent); padding: 2px 8px; border-radius: 12px; transition: all 0.2s; white-space: nowrap; }
        .context-link:hover { background: var(--accent); color: white; }

        /* Navigation Bar Ultra-Compact */
        .nav-bar { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; background: white; padding: 4px 15px; border-radius: 50px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); height: 40px; }
        
        /* Nav Buttons */
        .nav-btn { 
            background: white; 
            border: 1px solid #ccc; 
            width: 30px; 
            height: 30px; 
            border-radius: 50%; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            transition: all 0.2s; 
            overflow: hidden; 
        }
        .nav-btn img { width: 14px; height: 14px; object-fit: contain; }
        .nav-btn:hover:not(:disabled) { 
            background: #eaf6ff; 
            border-color: var(--accent);
            transform: scale(1.1); 
        }
        
        #step-indicator { font-size: 1em; font-weight: bold; color: var(--primary); }

        /* Main Content Card (Laptop Optimized: 480px) */
        .content-card { 
            background: var(--panel-bg); 
            border-radius: 8px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            overflow: hidden; 
            display: flex; 
            flex-direction: column; 
            height: 480px; 
            position: relative;
        }

        /* Tabs */
        .tabs-header { display: flex; background: #f1f1f1; border-bottom: 1px solid var(--border); height: 35px; flex-shrink: 0; }
        .tab-btn { flex: 1; border: none; background: transparent; cursor: pointer; font-weight: 600; color: #7f8c8d; border-bottom: 3px solid transparent; transition: all 0.2s; font-size: 0.85rem; padding: 0; }
        .tab-btn:hover { background: #e8e8e8; color: var(--primary); }
        .tab-btn.active { background: white; border-bottom-color: var(--accent); color: var(--accent); }

        /* Viewport */
        .viewport { flex: 1; position: relative; overflow: hidden; display: flex; flex-direction: column; }
        
        /* Image View */
        .view-image-container { flex: 1; display: flex; align-items: center; justify-content: center; padding: 5px; background-color: #fff; overflow: hidden; position: relative; }
        .main-image { max-width: 98%; max-height: 98%; object-fit: contain; }
        .image-caption { position: absolute; bottom: 5px; right: 10px; background: rgba(255,255,255,0.8); font-size: 0.7em; color: #999; padding: 2px 5px; border-radius: 4px; pointer-events: none; }

        /* Code View */
        .view-code-container { flex: 1; display: none; flex-direction: column; height: 100%; }
        .code-editor { 
            flex: 1; 
            width: 100%; 
            background-color: var(--code-bg); 
            color: var(--text-light); 
            font-family: 'Consolas', 'Monaco', monospace; 
            font-size: 12px; 
            line-height: 1.4; 
            padding: 10px; 
            border: none; 
            resize: none; 
            outline: none; 
            box-sizing: border-box;
        }

        /* Footer / Toolbar */
        .card-footer {
            height: 40px; 
            background: #f8f9fa;
            border-top: 1px solid #ddd;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            flex-shrink: 0;
        }

        .footer-label { font-size: 0.8em; font-weight: bold; color: #555; display: flex; align-items: center; gap: 5px; }
        .footer-links { display: flex; gap: 10px; }
        
        .tool-link { 
            font-size: 0.75em; 
            text-decoration: none; 
            color: var(--primary); 
            font-weight: 600; 
            display: flex; 
            align-items: center; 
            border: 1px solid #ccc; 
            padding: 3px 10px; 
            border-radius: 4px; 
            background: white; 
            transition: all 0.2s;
        }
        .tool-link:hover { color: var(--accent); border-color: var(--accent); transform: translateY(-1px); box-shadow: 0 2px 4px rgba(0,0,0,0.1); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="main-wrapper">
    <header>
        <h1>
            <a href="https://github.com/Echopraxium/tscp-framework" target="_blank" class="title-link" title="Visit TSCP Framework on GitHub">TSCP</a> 
            Case Study: GameStop "Short Squeeze" episode
        </h1>
        <div class="header-meta">
            <span class="subtitle">M2 Model Validation (v3.16)</span>
            <a href="https://en.wikipedia.org/wiki/GameStop_short_squeeze" target="_blank" class="context-link">üìñ Context (Wikipedia US)</a>
        </div>
    </header>

    <div class="nav-bar">
        <button id="btn-prev" class="nav-btn" onclick="app.prevStep()" title="Previous Step"><img src="img/left_arrow.png" alt="<"></button>
        <span id="step-indicator">Loading...</span>
        <button id="btn-next" class="nav-btn" onclick="app.nextStep()" title="Next Step"><img src="img/right_arrow.png" alt=">"></button>
    </div>

    <div class="content-card">
        <div class="tabs-header" id="tabs-container"></div>

        <div class="viewport">
            
            <div id="mode-viz" class="view-image-container">
                <img id="viz-img" class="main-image" src="" alt="Image not found. Check the /img folder">
                <div class="image-caption">GraphViz Visualization (.png)</div>
            </div>

            <div id="mode-code" class="view-code-container">
                <textarea id="code-area" class="code-editor" readonly spellcheck="false"></textarea>
            </div>

        </div>

        <div class="card-footer">
            <span class="footer-label">üîß Tools:</span>
            <div class="footer-links">
                <a href="https://github.com/Echopraxium/tscp-framework" target="_blank" class="tool-link">üì¶ GitHub Project</a>
                <a href="https://atomgraph.github.io/SPARQL-Playground/" target="_blank" class="tool-link">‚ö° AtomGraph (SPARQL)</a>
                <a href="https://edotor.net/" target="_blank" class="tool-link">‚ö° Edotor.net (DOT)</a>
            </div>
        </div>
    </div>
</div>

<script>
// --- DATA (English Labels + Content + JSONLD FIX) ---
const DATA = [
    {
        id: "static",
        title: "0. Static View (M0 Structure)",
        image: "img/StaticView.png",
        views: [
            { id: "viz", label: "üñºÔ∏è Visualization", type: "image" },
            { id: "jsonld", label: "üìÑ JSON-LD (Corrected)", type: "code", content: `{
  "@context": {
    "tscp": "https://github.com/Echopraxium/tscp-framework/ontology/",
    "m2": "https://github.com/Echopraxium/tscp-framework/ontology/TSCP_M2_Ontology.jsonld#",
    "inst": "https://github.com/Echopraxium/tscp-framework/poc/case-studies/Gamestop-Short-Squeeze-Episode#",
    "sig": "tscp:tensorSignature",
    
    "m2:supports": { "@type": "@id" },
    "m2:induces": { "@type": "@id" },
    "m2:consumes": { "@type": "@id" },
    "m2:requires": { "@type": "@id" },
    "m2:orchestrates": { "@type": "@id" },
    "m2:Diagnostic": { "@type": "@id" },
    "m2:Dysfunction": { "@type": "@id" },
    "m2:Component": { "@type": "@id" }
  },
  "@id": "inst:GameStopEvent_System",
  "@type": "m2:System",
  "sig": "\\\\mathbf{Sys}_{GME} = \\\\mathcal{S} \\\\otimes \\\\mathcal{A}_{dom} \\\\otimes \\\\mathcal{A}_{swarm}",
  "@graph": [
    {
      "@id": "inst:MarketSubstrate",
      "@type": "m2:Substrate",
      "rdfs:label": "NYSE Market",
      "sig": "\\\\eta_{market} \\\\in \\\\mathbb{R}^{n \\\\times n}",
      "m2:supports": ["inst:MelvinCapital", "inst:RedditSwarm"]
    },
    {
      "@id": "inst:MelvinCapital",
      "@type": "m2:Agent",
      "rdfs:label": "Melvin Capital",
      "sig": "\\\\mathcal{A}_{dom} = \\\\mathbf{O}_{short} \\\\otimes E_{cap}",
      "m2:Role": "Short Seller",
      "m2:induces": "inst:NakedShortConstraint"
    },
    {
      "@id": "inst:NakedShortConstraint",
      "@type": "m2:Constraint",
      "rdfs:label": "Short Interest > 140%",
      "sig": "\\\\| \\\\mathbf{C}_{short} \\\\| > 1.4 \\\\cdot R_{total}"
    }
  ]
}` },
            { id: "dot", label: "üìÑ GraphViz (.dot)", type: "code", content: `digraph StaticView {
  rankdir=TB;
  fontname="Arial";
  node [fontname="Arial", shape=box, style="filled,rounded"];
  edge [fontname="Arial", fontsize=10];

  subgraph cluster_substrate {
    label = "Substrate: NYSE Market\\nSig: eta (Liquidit√©)";
    style = dashed; color = "#7f8c8d"; fontcolor = "#7f8c8d"; bgcolor = "#fbfbfb";

    Melvin [label="Melvin Capital\\nRole: Short Seller\\nSig: A = O x E", fillcolor="#E0E0E0"];
    Swarm  [label="Reddit Swarm\\nRole: Retail\\nSig: Sum(i x e)", fillcolor="#CCFFCC"];
  }

  Constraint [shape=note, fillcolor="#FFEEEE", label="Short Interest > 140%\\nSig: ||C|| > 1.4 R"];
  Melvin -> Constraint [label="m2:induces"];
}` },
            { id: "sparql", label: "üìÑ SPARQL", type: "code", content: `PREFIX m2: <https://github.com/Echopraxium/tscp-framework/ontology/TSCP_M2_Ontology.jsonld#>
PREFIX tscp: <https://github.com/Echopraxium/tscp-framework/ontology/>
PREFIX inst: <https://github.com/Echopraxium/tscp-framework/poc/case-studies/Gamestop-Short-Squeeze-Episode#>

CONSTRUCT {
  inst:GameStopEvent_System m2:Component ?agent .
  ?agent m2:Role ?role .
  inst:MarketSubstrate m2:supports ?agent .
  ?agent m2:induces ?constraint .
}
WHERE {
  inst:MarketSubstrate m2:supports ?agent .
  ?agent m2:Role ?role .
  OPTIONAL { ?agent m2:induces ?constraint . }
}` }
        ]
    },
    {
        id: "step1",
        title: "1. Dysfunction (Systemic Imbalance)",
        image: "img/step1_dysfunction.png",
        views: [
            { id: "viz", label: "üñºÔ∏è Visualization", type: "image" },
            { id: "sparql", label: "üìÑ SPARQL", type: "code", content: `PREFIX m2: <https://github.com/Echopraxium/tscp-framework/ontology/TSCP_M2_Ontology.jsonld#>
PREFIX tscp: <https://github.com/Echopraxium/tscp-framework/ontology/>
PREFIX inst: <https://github.com/Echopraxium/tscp-framework/poc/case-studies/Gamestop-Short-Squeeze-Episode#>

CONSTRUCT {
  inst:MelvinCapital m2:induces ?constraint .
  ?constraint m2:Dysfunction ?risk .
  ?constraint tscp:tensorSignature ?cSig .
}
WHERE {
  inst:MelvinCapital m2:induces ?constraint .
  ?constraint m2:Dysfunction ?risk .
  ?constraint tscp:tensorSignature ?cSig .
}` },
            { id: "rdf", label: "üìÑ RDF (.nt)", type: "code", content: `<inst:MelvinCapital> <m2:induces> <inst:NakedShortConstraint> .
<inst:NakedShortConstraint> <m2:Dysfunction> <inst:SystemicImbalance> .
<inst:NakedShortConstraint> <tscp:tensorSignature> "\\\\| \\\\mathbf{C}_{short} \\\\| > 1.4 \\\\cdot R_{total}" .
<inst:SystemicImbalance> <rdfs:label> "Liquidity Crisis Risk" .` },
            { id: "dot", label: "üìÑ GraphViz (.dot)", type: "code", content: `digraph Step1_Dysfunction {
  rankdir=LR;
  fontname="Arial";
  node [fontname="Arial", shape=box, style="filled,rounded"];
  edge [fontname="Arial", fontsize=10];

  Melvin [label="Melvin Capital\\nSig: A = O x E", fillcolor="#E0E0E0"];
  Constraint [label="Short Interest > 140%\\nSig: ||C|| > 1.4 R", shape=note, fillcolor="#FFEEEE"];
  Risk [label="Liquidity Crisis\\nSig: e > theta", shape=ellipse, fillcolor="#FF0000", fontcolor=white];

  Melvin -> Constraint [label="m2:induces"];
  Constraint -> Risk [label="m2:Dysfunction", style=dashed, color=red];
}` }
        ]
    },
    {
        id: "step2",
        title: "2. Synergy (Alignment)",
        image: "img/step2_synergy.png",
        views: [
            { id: "viz", label: "üñºÔ∏è Visualization", type: "image" },
            { id: "sparql", label: "üìÑ SPARQL", type: "code", content: `PREFIX m2: <https://github.com/Echopraxium/tscp-framework/ontology/TSCP_M2_Ontology.jsonld#>
PREFIX inst: <https://github.com/Echopraxium/tscp-framework/poc/case-studies/Gamestop-Short-Squeeze-Episode#>

CONSTRUCT {
  inst:RoaringKitty m2:induces ?msg .
  inst:RedditSwarm m2:consumes ?msg .
  inst:RedditSwarm m2:Mode "Synergy" .
}
WHERE {
  inst:RoaringKitty m2:induces ?msg .
  inst:RedditSwarm m2:consumes ?msg .
}` },
            { id: "rdf", label: "üìÑ RDF (.nt)", type: "code", content: `<inst:RoaringKitty> <m2:induces> <inst:DeepValueThesis> .
<inst:RedditSwarm> <m2:consumes> <inst:DeepValueThesis> .
<inst:RedditSwarm> <m2:Mode> "Synergy" .
<inst:DeepValueThesis> <tscp:tensorSignature> "\\\\vec{s}_{bull} = \\\\langle \\\\text{Info}, \\\\text{Noise} \\\\rangle" .` },
            { id: "dot", label: "üìÑ GraphViz (.dot)", type: "code", content: `digraph Step2_Synergy {
  rankdir=LR;
  fontname="Arial";
  node [fontname="Arial", shape=box, style="filled,rounded"];
  edge [fontname="Arial", fontsize=10];

  Kitty [label="Roaring Kitty\\nSig: O: V -> I", shape=diamond, fillcolor="#CCF2FF"];
  Thesis [label="Signal: Thesis\\nSig: <Info, Noise>", shape=folder, fillcolor="#FFFFCC"];
  Swarm [label="Reddit Swarm\\nSig: Sum(i x e)", shape=doublecircle, fillcolor="#CCFFCC"];

  Kitty -> Thesis [label="m2:induces"];
  Swarm -> Thesis [label="m2:consumes"];
  Swarm -> Swarm [label="Mode: Synergy", color="#00aa00"];
}` }
        ]
    },
    {
        id: "step3",
        title: "3. Feedback Loop (The Squeeze)",
        image: "img/step3_feedback.png",
        views: [
            { id: "viz", label: "üñºÔ∏è Visualization", type: "image" },
            { id: "sparql", label: "üìÑ SPARQL", type: "code", content: `PREFIX m2: <https://github.com/Echopraxium/tscp-framework/ontology/TSCP_M2_Ontology.jsonld#>
PREFIX inst: <https://github.com/Echopraxium/tscp-framework/poc/case-studies/Gamestop-Short-Squeeze-Episode#>

CONSTRUCT {
  inst:MassBuyingProcess m2:induces ?event .
  inst:SqueezeLoop m2:requires ?event .
  inst:SqueezeLoop m2:induces ?repair .
  ?repair m2:consumes inst:MelvinCapital .
}
WHERE {
  inst:MassBuyingProcess m2:induces ?event .
  inst:SqueezeLoop m2:requires ?event .
  inst:SqueezeLoop m2:induces ?repair .
  ?repair m2:consumes inst:MelvinCapital .
}` },
            { id: "rdf", label: "üìÑ RDF (.nt)", type: "code", content: `<inst:MassBuyingProcess> <m2:induces> <inst:PriceExplosion> .
<inst:SqueezeLoop> <m2:requires> <inst:PriceExplosion> .
<inst:SqueezeLoop> <tscp:tensorSignature> "\\\\beta > 0 \\\\implies v_{t+1} > v_t" .
<inst:SqueezeLoop> <m2:induces> <inst:ForcedLiquidation> .
<inst:ForcedLiquidation> <m2:consumes> <inst:MelvinCapital> .` },
            { id: "dot", label: "üìÑ GraphViz (.dot)", type: "code", content: `digraph Step3_Squeeze {
  rankdir=TD;
  fontname="Arial";
  node [fontname="Arial", shape=box, style="filled,rounded"];
  edge [fontname="Arial", fontsize=10];

  Buying [label="Mass Buying\\nSig: T = Int(F dt)", fillcolor="#99FF99"];
  Surge [label="Price Surge\\nSig: dv/dt -> inf", shape=star, fillcolor="#FFFF00"];
  Feedback [label="Feedback Loop\\nSig: beta > 0", shape=circle, width=1.3, fixedsize=true, fillcolor="#3366FF", fontcolor=white];
  Repair [label="Repair (Forced)\\nSig: T = H(e-theta).C", style="filled,bold", fillcolor="#FF9999"];

  Buying -> Surge [label="m2:induces"];
  Surge -> Feedback [label="m2:requires"];
  Feedback -> Repair [label="m2:induces (Repair)"];
  Repair -> Buying [label="reinforces", style=dashed, color=red];
}` }
        ]
    }
];

// --- APP LOGIC ---
const app = {
    currentStep: 0,
    currentViewId: 'viz',

    init: function() {
        this.render();
    },

    nextStep: function() {
        this.currentStep = (this.currentStep + 1) % DATA.length;
        this.currentViewId = 'viz'; 
        this.render();
    },

    prevStep: function() {
        this.currentStep = (this.currentStep - 1 + DATA.length) % DATA.length;
        this.currentViewId = 'viz'; 
        this.render();
    },

    switchView: function(viewId) {
        this.currentViewId = viewId;
        this.renderContent();
        this.updateTabsState();
    },

    render: function() {
        const step = DATA[this.currentStep];
        document.getElementById('step-indicator').textContent = step.title;

        // Tabs
        const tabsContainer = document.getElementById('tabs-container');
        tabsContainer.innerHTML = '';
        
        step.views.forEach(view => {
            const btn = document.createElement('button');
            btn.className = `tab-btn ${view.id === this.currentViewId ? 'active' : ''}`;
            btn.textContent = view.label;
            btn.onclick = () => app.switchView(view.id);
            tabsContainer.appendChild(btn);
        });

        this.renderContent();
    },

    renderContent: function() {
        const step = DATA[this.currentStep];
        const currentView = step.views.find(v => v.id === this.currentViewId);
        
        const vizContainer = document.getElementById('mode-viz');
        const codeContainer = document.getElementById('mode-code');
        
        if (currentView.type === 'image') {
            vizContainer.classList.remove('hidden');
            codeContainer.classList.add('hidden');
            document.getElementById('viz-img').src = step.image;
        } 
        else if (currentView.type === 'code') {
            vizContainer.classList.add('hidden');
            codeContainer.classList.remove('hidden');
            codeContainer.style.display = 'flex'; 
            document.getElementById('code-area').value = currentView.content;
        }
    },

    updateTabsState: function() {
        const buttons = document.querySelectorAll('.tab-btn');
        const step = DATA[this.currentStep];
        buttons.forEach((btn, index) => {
            if (step.views[index].id === this.currentViewId) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        });
    }
};

app.init();
</script>
</body>
</html>